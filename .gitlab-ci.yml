stages:
  - test

variables:
  CONTAINER_MEMORY: "6g"
  SHARED_MEMORY: "4g"

test:
  stage: test
  image: docker:latest  # Docker 실행 환경
  services:
    - docker:dind  # Docker-in-Docker 활성화
  before_script:
    - export DOCKER_BUILDKIT=1
    - docker info  # Docker 실행 상태 확인
    - docker build -t test-runner .  # Docker 이미지를 먼저 빌드
  script:
    - docker-compose up -d  # 컨테이너 실행
    - docker exec test-runner pytest src/tests/ui_tests --html=docker_report.html --self-contained-html
  only:
    - main
